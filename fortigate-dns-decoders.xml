<!-- 
Custom Decoders For Fortigate Firewall DNS Queries
Author: Aziz Kaplan <aziz.kaplan@infinitumit.com.tr>
Github: https://github.com/AzizKpln
-->


<!--
date=2019-05-15 time=15:05:49 logid="1501054802" type="utm" subtype="dns" eventtype="dns-response" level="notice" vd="vdom1" eventtime=1557957949740931155 policyid=1 sessionid=6887 srcip=10.1.100.22 srcport=50002 srcintf="port12" srcintfrole="undefined" dstip=172.16.100.100 dstport=53 dstintf="port11" dstintfrole="undefined" proto=17 profile="dnsfilter_fgd" srcmac="a2:e9:00:ec:40:41" xid=57945 qname="changelogs.ubuntu.com" qtype="AAAA" qtypeval=28 qclass="IN" ipaddr="2001:67c:1560:8008::11" msg="Domain is monitored" action="pass" cat=52 catdesc="Information Technology"
-->

<decoder name="fortigate-firewall-dns-v1">
    <prematch>date=\d\d\d\d-\d\d-\d\d time=\d\d:\d\d:\d\d logid=</prematch>
    <type>syslog</type>
</decoder>
<decoder name="fortigate-firewall-dns-v1-fields">
    <parent>fortigate-firewall-dns-v1</parent>
    <regex offset="after_parent">"(\S+)" type="(\S+)" subtype=(\S+) eventtype="(\S+)" level="(\S+)"</regex>
    <order>logid,type,subtype,eventtype,level</order>
</decoder>
<decoder name="fortigate-firewall-dns-v1-fields">
    <parent>fortigate-firewall-dns-v1</parent>
    <regex offset="after_regex">vd="(\S+)" eventtime=(\S+) policyid=(\S+) sessionid=(\S+)</regex>
    <order>virtualDomain,eventtime,policyid,sessionid</order>
</decoder>
<decoder name="fortigate-firewall-dns-v1-fields">
    <parent>fortigate-firewall-dns-v1</parent>
    <regex offset="after_regex">srcip=(\S+) srcport=(\S+) srcintf="(\S+)" srcintfrole="(\S+)"</regex>
    <order>srcip,srcport,srcintf,srcintfrole</order>
</decoder>
<decoder name="fortigate-firewall-dns-v1-fields">
    <parent>fortigate-firewall-dns-v1</parent>
    <regex offset="after_regex">dstip=(\S+) dstport=(\S+) dstintf="(\S+)" dstintfrole="(\S+)"</regex>
    <order>dstip,dstport,dstintf,dstintfrole</order>
</decoder>
<decoder name="fortigate-firewall-dns-v1-fields">
    <parent>fortigate-firewall-dns-v1</parent>
    <regex offset="after_regex">proto=(\S+) profile=(\S+) srcmac="(\S+)" xid=(\S+)</regex>
    <order>proto,profile,srcmac,xid</order>
</decoder>
<decoder name="fortigate-firewall-dns-v1-fields">
    <parent>fortigate-firewall-dns-v1</parent>
    <regex offset="after_regex">qname="(\S+)" qtype="(\S+)" qtypeval=(\S+) qclass="(\S+)"</regex>
    <order>qname,qtype,qtypeval,qclass</order>
</decoder>
<decoder name="fortigate-firewall-dns-v1-fields">
    <parent>fortigate-firewall-dns-v1</parent>
    <regex offset="after_regex">ipaddr="(\S+)"|ipaddr=(\S+) msg="(.*)" action="(\S+)" cat=(\S+)</regex>
    <order>ipaddr,msg,action,cat</order>
</decoder>
<decoder name="fortigate-firewall-dns-v1-fields">
    <parent>fortigate-firewall-dns-v1</parent>
    <regex offset="after_regex">catdesc="(\S+)"</regex>
    <order>catdesc</order>
</decoder>


<!--
date=2019-05-15 time=15:05:49 logid="1500054000" type="utm" subtype="dns" eventtype="dns-query" level="information" vd="vdom1" eventtime=1557957949653103543 policyid=1 sessionid=6887 srcip=10.1.100.22 srcport=50002 srcintf="port12" srcintfrole="undefined" dstip=172.16.100.100 dstport=53 dstintf="port11" dstintfrole="undefined" proto=17 profile="dnsfilter_fgd" srcmac="a2:e9:00:ec:40:41" xid=57945 qname="changelogs.ubuntu.com" qtype="AAAA" qtypeval=28 qclass="IN"
-->

<decoder name="fortigate-firewall-dns-v2">
    <prematch>date=\d\d\d\d-\d\d-\d\d time=\d\d:\d\d:\d\d logid=</prematch>
    <type>syslog</type>
</decoder>
<decoder name="fortigate-firewall-dns-v2-fields">
    <parent>fortigate-firewall-dns-v2</parent>
    <regex offset="after_parent">"(\S+)" type="(\S+)" subtype=(\S+) eventtype="(\S+)" level="(\S+)"</regex>
    <order>logid,type,subtype,eventtype,level</order>
</decoder>
<decoder name="fortigate-firewall-dns-v2-fields">
    <parent>fortigate-firewall-dns-v2</parent>
    <regex offset="after_regex">vd="(\S+)" eventtime=(\S+) policyid=(\S+) sessionid=(\S+)</regex>
    <order>virtualDomain,eventtime,policyid,sessionid</order>
</decoder>
<decoder name="fortigate-firewall-dns-v2-fields">
    <parent>fortigate-firewall-dns-v2</parent>
    <regex offset="after_regex">srcip=(\S+) srcport=(\S+) srcintf="(\S+)" srcintfrole="(\S+)"</regex>
    <order>srcip,srcport,srcintf,srcintfrole</order>
</decoder>
<decoder name="fortigate-firewall-dns-v2-fields">
    <parent>fortigate-firewall-dns-v2</parent>
    <regex offset="after_regex">dstip=(\S+) dstport=(\S+) dstintf="(\S+)" dstintfrole="(\S+)"</regex>
    <order>dstip,dstport,dstintf,dstintfrole</order>
</decoder>
<decoder name="fortigate-firewall-dns-v2-fields">
    <parent>fortigate-firewall-dns-v2</parent>
    <regex offset="after_regex">proto=(\S+) profile=(\S+) srcmac="(\S+)" xid=(\S+)</regex>
    <order>proto,profile,srcmac,xid</order>
</decoder>
<decoder name="fortigate-firewall-dns-v2-fields">
    <parent>fortigate-firewall-dns-v2</parent>
    <regex offset="after_regex">qname="(\S+)" qtype="(\S+)" qtypeval=(\S+) qclass="(\S+)"</regex>
    <order>qname,qtype,qtypeval,qclass</order>
</decoder>
